<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 McDraper Super Bowl LX Prop Bets</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèà</text></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --seahawks-blue: #002244;
            --seahawks-green: #69BE28;
            --seahawks-gray: #A5ACAF;
            --patriots-navy: #002244;
            --patriots-red: #C60C30;
            --patriots-silver: #B0B7BC;
            --bg-dark: #0a0e27;
            --bg-card: #1a1f3a;
            --text-primary: #ffffff;
            --text-secondary: #b8c5d6;
            --accent-glow: #69BE28;
            --gold: #ffd700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto Condensed', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1535 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.05) 35px, rgba(255,255,255,.05) 70px);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(198, 12, 48, 0.3) 0%, rgba(0, 34, 68, 0.3) 100%);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.25);
            position: relative;
            overflow: visible;
            z-index: 1;
        }

        .header h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: clamp(2rem, 5vw, 4rem);
            letter-spacing: 3px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-title-text {
            display: inline-block;
        }

        .header-title-text .word-1 {
            color: var(--patriots-red);
        }

        .header-title-text .word-2 {
            color: var(--text-primary);
        }

        .header-title-text .word-3 {
            color: var(--text-secondary);
        }

        .header-title-text .word-4 {
            color: var(--seahawks-green);
        }

        .header-title-text .word-5 {
            color: var(--patriots-silver);
        }

        .team-logo {
            width: clamp(50px, 8vw, 80px);
            height: clamp(50px, 8vw, 80px);
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
            animation: float 3s ease-in-out infinite;
        }

        .team-logo.patriots {
            animation-delay: 0s;
        }

        .team-logo.seahawks {
            animation-delay: 1.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .search-pin-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'Roboto Condensed', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--seahawks-green);
            box-shadow: 0 0 15px rgba(105, 190, 40, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .pinned-players {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .pinned-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .pinned-tag {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(105, 190, 40, 0.15);
            border: 1px solid var(--seahawks-green);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .pinned-tag-icon {
            color: var(--seahawks-green);
            font-size: 0.9rem;
        }

        .pinned-tag-remove {
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1;
            transition: color 0.2s ease;
            padding: 0 0 0 5px;
        }

        .pinned-tag-remove:hover {
            color: var(--patriots-red);
        }

        .pinned-row {
            background: rgba(105, 190, 40, 0.08) !important;
            border-left: 3px solid var(--seahawks-green) !important;
        }

        .pinned-row td:first-child::before {
            content: 'üìå ';
            margin-right: 5px;
        }

        .clear-pins-btn {
            padding: 8px 15px;
            background: rgba(198, 12, 48, 0.2);
            border: 1px solid var(--patriots-red);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clear-pins-btn:hover {
            background: rgba(198, 12, 48, 0.4);
            transform: translateY(-2px);
        }

        .question-toggle-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px 0;
        }

        .question-toggle-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .toggle-switch.active {
            background: var(--seahawks-green);
            border-color: var(--seahawks-green);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            left: 32px;
        }

        .question-details-panel {
            background: rgba(105, 190, 40, 0.05);
            border: 1px solid var(--seahawks-green);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .question-item {
            display: flex;
            gap: 10px;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .question-number {
            font-weight: 700;
            color: var(--seahawks-green);
            min-width: 30px;
        }

        .question-text {
            flex: 1;
            color: var(--text-primary);
        }

        .question-result {
            color: var(--seahawks-green);
            font-weight: 600;
        }

        .question-pending {
            color: var(--text-secondary);
            font-style: italic;
        }

        .question-filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .filter-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--seahawks-green);
            color: var(--text-primary);
        }

        .filter-button.active {
            background: var(--seahawks-green);
            border-color: var(--seahawks-green);
            color: white;
            box-shadow: 0 2px 10px rgba(105, 190, 40, 0.3);
        }

        .filter-count {
            display: inline-block;
            margin-left: 6px;
            padding: 2px 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .filter-button.active .filter-count {
            background: rgba(255, 255, 255, 0.25);
        }

        .header .subtitle {
            font-family: 'Oswald', sans-serif;
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 217, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.2);
            border-color: var(--accent-glow);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-glow);
        }

        .prize-value {
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            background: var(--bg-card);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tab:hover {
            border-color: var(--accent-glow);
            color: var(--text-primary);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--patriots-red), var(--seahawks-blue));
            border-color: transparent;
            color: white;
            box-shadow: 0 5px 20px rgba(198, 12, 48, 0.4);
        }

        .leaderboard {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 60px 1fr 100px 120px;
            gap: 15px;
            padding: 15px 20px;
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px 120px;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            margin-bottom: 10px;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .leaderboard-row:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-glow);
            transform: translateX(5px);
        }

        .rank {
            font-family: 'Bebas Neue', cursive;
            font-size: 2rem;
            text-align: center;
            color: var(--accent-glow);
        }

        .rank-1 { color: var(--gold); text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .rank-2 { color: #C0C0C0; text-shadow: 0 0 20px rgba(192, 192, 192, 0.3); }
        .rank-3 { color: #CD7F32; text-shadow: 0 0 20px rgba(205, 127, 50, 0.3); }

        .player-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .points {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            color: var(--accent-glow);
        }

        .percentage {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .prize-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .prize-card {
            background: linear-gradient(135deg, rgba(198, 12, 48, 0.1), rgba(0, 34, 68, 0.1));
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            isolation: isolate;
        }

        .prize-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(105, 190, 40, 0.3);
            border-color: var(--seahawks-green);
            z-index: 10000;
        }

        .prize-tooltip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--bg-card);
            border: 3px solid var(--seahawks-green);
            border-radius: 12px;
            padding: 20px;
            min-width: 280px;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 999999;
            backdrop-filter: blur(10px);
        }

        .prize-card:hover .prize-tooltip {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .prize-tooltip::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: -1;
        }

        .prize-tooltip-title {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            color: var(--seahawks-green);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prize-tooltip-player {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .prize-tooltip-player-name {
            color: var(--text-primary);
        }

        .prize-tooltip-player-amount {
            color: var(--gold);
            font-weight: 600;
        }

        .prize-tooltip-total {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .prize-tooltip-total-label {
            color: var(--text-primary);
        }

        .prize-tooltip-total-amount {
            color: var(--gold);
        }

        .prize-place {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .prize-amount {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            margin-bottom: 5px;
        }

        .prize-winners {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .trends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .trend-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .trend-question {
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 15px;
            font-weight: 600;
            line-height: 1.4;
        }

        .trend-option {
            margin-bottom: 12px;
        }

        .trend-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .trend-name {
            color: var(--text-secondary);
        }

        .trend-percent {
            color: var(--accent-glow);
            font-weight: 600;
        }

        .trend-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .trend-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--patriots-red), var(--seahawks-blue));
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .trend-fill.seahawks {
            background: linear-gradient(90deg, var(--seahawks-green), var(--seahawks-blue));
        }

        .trend-fill.patriots {
            background: linear-gradient(90deg, var(--patriots-red), #8B1538);
        }

        .trend-fill.over {
            background: linear-gradient(90deg, var(--patriots-red), #FF6B6B);
        }

        .trend-fill.under {
            background: linear-gradient(90deg, var(--seahawks-blue), #4A90E2);
        }

        .trend-fill.yes {
            background: linear-gradient(90deg, var(--seahawks-green), #7FD66E);
        }

        .trend-fill.no {
            background: linear-gradient(90deg, var(--patriots-red), #E85D75);
        }

        .chat-container {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--accent-glow);
            border-radius: 4px;
        }

        .chat-message {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-glow);
        }

        .chat-author {
            font-weight: 700;
            color: var(--accent-glow);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .chat-text {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .chat-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'Roboto Condensed', sans-serif;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-glow);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
        }

        .chat-button {
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--patriots-red), var(--seahawks-blue));
            border: none;
            border-radius: 10px;
            color: white;
            font-family: 'Oswald', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(198, 12, 48, 0.4);
        }

        .chat-button:active {
            transform: translateY(0);
        }

        .chat-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, rgba(198, 12, 48, 0.5), rgba(0, 34, 68, 0.5));
            transform: none !important;
            box-shadow: none !important;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .error {
            background: rgba(198, 12, 48, 0.2);
            border: 2px solid var(--patriots-red);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .update-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--accent-glow);
            border-radius: 25px;
            font-size: 0.85rem;
            color: var(--accent-glow);
            box-shadow: 0 5px 20px rgba(0, 217, 255, 0.3);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .full-results-table {
            overflow-x: auto;
            margin-top: 20px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .results-table th {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 8px;
            text-align: left;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .results-table th:hover {
            background: rgba(105, 190, 40, 0.1);
            color: var(--seahawks-green);
        }

        .results-table th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.3;
        }

        .results-table th.sorted-asc::after {
            content: ' ‚ñ≤';
            opacity: 1;
            color: var(--seahawks-green);
        }

        .results-table th.sorted-desc::after {
            content: ' ‚ñº';
            opacity: 1;
            color: var(--seahawks-green);
        }

        .question-cell {
            position: relative;
            cursor: help;
        }

        .question-tooltip {
            position: fixed;
            bottom: auto;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: var(--bg-card);
            border: 2px solid var(--seahawks-green);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s ease;
            z-index: 9999;
            white-space: normal;
            text-align: left;
        }

        .question-cell:hover .question-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-15px);
        }

        .question-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--seahawks-green);
        }

        .question-tooltip-title {
            font-weight: 600;
            color: var(--seahawks-green);
            margin-bottom: 8px;
            font-size: 0.85rem;
            line-height: 1.3;
        }

        .question-tooltip-result {
            color: var(--text-primary);
            font-size: 0.8rem;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .question-tooltip-result-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .question-tooltip-pending {
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.75rem;
        }

        .results-table td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .results-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .correct-pick {
            color: #4ade80;
            font-weight: 600;
        }

        .incorrect-pick {
            color: #f87171;
        }

        .pending-pick {
            color: var(--text-secondary);
        }

        /* Countdown Mode Styles */
        .countdown-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .countdown-title {
            font-family: 'Bebas Neue', cursive;
            font-size: clamp(2.5rem, 6vw, 5rem);
            margin-bottom: 30px;
            background: linear-gradient(45deg, var(--patriots-red), var(--seahawks-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .countdown-timer {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 40px 0;
            max-width: 600px;
        }

        .countdown-unit {
            background: var(--bg-card);
            border: 2px solid var(--seahawks-green);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(105, 190, 40, 0.2);
        }

        .countdown-number {
            font-family: 'Bebas Neue', cursive;
            font-size: 3rem;
            color: var(--seahawks-green);
            text-shadow: 0 0 20px rgba(105, 190, 40, 0.5);
        }

        .countdown-label {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .countdown-message {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin: 20px 0;
            line-height: 1.6;
        }

        .countdown-live-message {
            font-family: 'Bebas Neue', cursive;
            font-size: 3rem;
            color: var(--seahawks-green);
            text-shadow: 0 0 30px rgba(105, 190, 40, 0.5);
            animation: pulse-text 2s ease-in-out infinite;
        }

        @keyframes pulse-text {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .admin-login-link {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            opacity: 0.05;
            transition: opacity 0.3s ease;
            z-index: 10000;
            font-size: 20px;
        }

        .admin-login-link:hover {
            opacity: 0.3;
        }

        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999999;
        }

        .admin-modal-content {
            background: var(--bg-card);
            border: 2px solid var(--seahawks-green);
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .admin-modal-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            color: var(--seahawks-green);
            margin-bottom: 20px;
        }

        .admin-code-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            text-align: center;
            margin-bottom: 15px;
            font-family: 'Roboto Condensed', sans-serif;
        }

        .admin-code-input:focus {
            outline: none;
            border-color: var(--seahawks-green);
        }

        .admin-button {
            padding: 12px 25px;
            background: var(--seahawks-green);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(105, 190, 40, 0.4);
        }

        .admin-button.cancel {
            background: rgba(255, 255, 255, 0.1);
        }

        .admin-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            background: var(--seahawks-green);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            z-index: 10000;
            box-shadow: 0 2px 10px rgba(105, 190, 40, 0.4);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .leaderboard-header,
            .leaderboard-row {
                grid-template-columns: 50px 1fr 80px;
                gap: 10px;
            }

            .percentage {
                display: none;
            }

            .header {
                padding: 20px 15px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .trends-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                width: 100%;
            }

            .countdown-timer {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .countdown-number {
                font-size: 2.5rem;
            }
        }
        
        /* Penultimate (Second to Last) Styling */
        .rank-penultimate { 
            color: #ff69b4; /* Hot Pink */
            text-shadow: 0 0 15px rgba(255, 105, 180, 0.6);
            font-weight: bold;
        }
        
/* Tour System Styles */
        .tour-replay-button {
            position: fixed;
            bottom: 60px;
            right: 10px;
            width: 35px;
            height: 35px;
            background: rgba(105, 190, 40, 0.15);
            border: 1px solid var(--seahawks-green);
            border-radius: 50%;
            cursor: pointer;
            opacity: 0.4;
            transition: all 0.3s ease;
            z-index: 9998;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--seahawks-green);
        }

        .tour-replay-button:hover {
            opacity: 1;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(105, 190, 40, 0.4);
        }

        .tour-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent; /* KEY FIX: Transparent so it's not double-dark */
            z-index: 999998;
            pointer-events: auto;
        }

        .tour-spotlight {
            position: fixed;
            border: 3px solid var(--seahawks-green);
            border-radius: 12px;
            /* KEY FIX: Lighter shadow (0.75) and smooth transition */
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75), 
                        0 0 30px rgba(105, 190, 40, 0.5);
            pointer-events: none;
            z-index: 999999;
            transition: all 0.3s ease-out; 
        }

        .tour-tooltip {
            position: fixed;
            background: var(--bg-card);
            border: 2px solid var(--seahawks-green);
            border-radius: 15px;
            padding: 25px;
            max-width: 400px;
            z-index: 1000000;
            pointer-events: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            transition: top 0.3s ease-out, left 0.3s ease-out;
        }

        .tour-tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .tour-tooltip-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.3rem;
            color: var(--seahawks-green);
            font-weight: 600;
        }

        .tour-tooltip-counter {
            font-size: 0.85rem;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .tour-tooltip-content {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .tour-screenshot {
            width: 100%;
            max-width: 350px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            margin: 15px 0;
        }

        .tour-tooltip-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tour-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tour-button-skip {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }

        .tour-button-skip:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .tour-button-next {
            background: var(--seahawks-green);
            color: white;
        }

        .tour-button-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(105, 190, 40, 0.4);
        }

        @media (max-width: 768px) {
            .tour-tooltip {
                max-width: 90%;
                padding: 20px;
            }
            
            .tour-tooltip-title {
                font-size: 1.1rem;
            }
        }
      /* Pick Cell Tooltip */
.pick-cell {
    position: relative;
    cursor: pointer;
}

.pick-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 8px;
    background: var(--bg-card);
    border: 2px solid var(--seahawks-green);
    border-radius: 8px;
    padding: 10px 12px;
    min-width: 120px;
    max-width: 250px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 10000;
    white-space: nowrap;
}
        
/* Flip tooltip downward for first row */
.pick-cell.first-row .pick-tooltip {
    bottom: auto;
    top: 100%;
    margin-bottom: 0;
    margin-top: 8px;
}
        
.pick-cell:hover .pick-tooltip,
.pick-cell.active .pick-tooltip {
    opacity: 1;
}

.pick-tooltip-label {
    color: var(--text-secondary);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.pick-tooltip-value {
    color: var(--text-primary);
    font-size: 0.85rem;
    font-weight: 600;
}

.pick-tooltip-value.correct {
    color: #4ade80;
}

.pick-tooltip-value.incorrect {
    color: #f87171;
}

.pick-tooltip-value.pending {
    color: var(--text-secondary); /* Grey for pending */
}

    </style>
</head>
<body>
    <div class="background-pattern"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================
        // CONFIGURATION - UPDATE THESE VALUES
        // ============================================
       const CONFIG = {
    // UPDATED URLS (Using /latest for jsonbin)
    DASHBOARD_URL: 'https://api.jsonbin.io/v3/b/69817bcc43b1c97be961464c',
    CHAT_READ_URL: 'https://api.jsonbin.io/v3/b/69817c4943b1c97be961473f',
    
    // NEW MASTER KEY LINE
    MASTER_KEY: '$2a$10$YiurugbTLQpar/JI7TGt6e4t2zBaEbvPb6jYsVv7x4s7oKUcm7Equ',
    
    // YOUR EXISTING APPS SCRIPT URL
    CHAT_WRITE_URL: 'https://script.google.com/macros/s/AKfycbwC5OaHUHbPhsxjJ0F94fhGYoG-ZjGWWUOyxKmke1uFNp5NQg2Aa03UkpaCwhEQNXc/exec',
    
    ADMIN_CODE: 'Lancers2826',
    GO_LIVE_DATE: new Date('2026-02-08T16:30:00-05:00').getTime(),
    REFRESH_INTERVAL: 10000,
    CHAT_ENABLED: true
};

// Decompress pick values
function decompressText(val) {
    if (!val) return val;
    const v = String(val);
    
    // Teams
    if (v === "NE") return "New England Patriots";
    if (v === "SEA") return "Seattle Seahawks";
    
    // Common Props
    if (v === "TO") return "Turnover";
    if (v === "TD") return "Touchdown";
    if (v === "FG") return "Field Goal";
    if (v === "SAF") return "Safety";
    if (v === "Y") return "Yes";
    if (v === "N") return "No";
    if (v === "Ov") return "Over";
    if (v === "Un") return "Under";
    if (v === "H") return "Heads";
    if (v === "T") return "Tails";
    if (v === "Odd") return "Odd";
    if (v === "Ev") return "Even";
    
    // Gatorade Colors
    if (v === "Blu") return "Blue";
    if (v === "Pur") return "Purple";
    if (v === "Yel") return "Yellow";
    if (v === "Org") return "Orange";
    if (v === "Clr") return "Clear";
    
    return v;
}

// Decompress question text
function decompressQuestion(q) {
    if (!q) return q;
    return q
        .replace(/^Team:/, "Which team will")
        .replace(/^#/, "How many")
        .replace(/NE/g, "New England Patriots")
        .replace(/SEA/g, "Seattle Seahawks")
        .replace(/\bTD\b/g, "touchdown")
        .replace(/\bFG\b/g, "field goal");
}

// Calculate trends from fullResults
function calculateTrends(data) {
    if (!data?.fullResults || !data?.questions) return [];
    
    const trends = [];
    
    data.questions.forEach((question, qIdx) => {
        if (!question || question === '') return;
        
        const pickCounts = {};
        let totalPicks = 0;
        
        data.fullResults.forEach(player => {
            const pick = player.k?.[qIdx];
            if (pick && pick !== '') {
                pickCounts[pick] = (pickCounts[pick] || 0) + 1;
                totalPicks++;
            }
        });
        
        const options = Object.entries(pickCounts)
            .map(([name, count]) => ({
                name: decompressText(name),
                percent: totalPicks > 0 ? Math.round((count / totalPicks) * 100) : 0
            }))
            .sort((a, b) => b.percent - a.percent);
        
        if (options.length > 0) {
            trends.push({
                question: decompressQuestion(question),
                options
            });
        }
    });
    
    return trends;
}
        // ============================================

        function App() {
            const [activeTab, setActiveTab] = useState('leaderboard');
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [chatMessages, setChatMessages] = useState([]);
            const [chatName, setChatName] = useState('');
            const [chatMessage, setChatMessage] = useState('');
            const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });
            const [searchTerm, setSearchTerm] = useState('');
            const [pinnedPlayers, setPinnedPlayers] = useState([]);
            const [showQuestionDetails, setShowQuestionDetails] = useState(false);
            const [isSendingChat, setIsSendingChat] = useState(false);
            const [questionFilter, setQuestionFilter] = useState('all');
            const [countdown, setCountdown] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });
            const [isLive, setIsLive] = useState(false);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [showAdminModal, setShowAdminModal] = useState(false);
            const [adminCodeInput, setAdminCodeInput] = useState('');
            const chatMessagesRef = useRef(null);
            const [activePickCell, setActivePickCell] = useState(null);
            
            const [tourActive, setTourActive] = useState(false);
            const [tourStep, setTourStep] = useState(0);
            const tourTargetRef = useRef(null);

            // Check if site should be live
            useEffect(() => {
                const checkLiveStatus = () => {
                    const now = new Date().getTime();
                    const timeUntilLive = CONFIG.GO_LIVE_DATE - now;
                    
                    if (timeUntilLive <= 0 || isAdminMode) {
                        setIsLive(true);
                        return;
                    }
                    
                    setIsLive(false);
                    
                    // Calculate countdown
                    const days = Math.floor(timeUntilLive / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeUntilLive % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeUntilLive % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeUntilLive % (1000 * 60)) / 1000);
                    
                    setCountdown({ days, hours, minutes, seconds });
                };
                
                checkLiveStatus();
                const interval = setInterval(checkLiveStatus, 1000);
                
                return () => clearInterval(interval);
            }, [isAdminMode]);

            // Admin code verification
            const handleAdminLogin = () => {
                if (adminCodeInput === CONFIG.ADMIN_CODE) {
                    setIsAdminMode(true);
                    setShowAdminModal(false);
                    setAdminCodeInput('');
                } else {
                    alert('Incorrect admin code');
                    setAdminCodeInput('');
                }
            };

            
            // Tour initialization - check if user has seen it
            useEffect(() => {
                const tourCompleted = localStorage.getItem('tourCompleted') === 'true';
                const tourStarted = localStorage.getItem('tourStarted') === 'true';
                
                // Only show tour if they haven't started it or completed it, and dashboard is live
                if (!tourCompleted && !tourStarted && isLive && data) {
                    // Small delay so data loads first
                    setTimeout(() => {
                        localStorage.setItem('tourStarted', 'true');
                        setTourActive(true);
                        setTourStep(0);
                    }, 1000);
                }
            }, [isLive, data]);


            // Fetch dashboard data from jsonbin (fast, scalable, no execution limits)
           const fetchData = async () => {
    try {
        const response = await fetch(CONFIG.DASHBOARD_URL + '/latest', {
            headers: {
                'X-Master-Key': CONFIG.MASTER_KEY
            }
        });
        if (!response.ok) throw new Error('Failed to fetch data');
        const json = await response.json();
        const result = json.record || json;
        setData(result);
        setError(null);
        setLastUpdate(new Date());
        setLoading(false);
    } catch (err) {
        console.error('Error fetching data:', err);
        setError('Unable to connect to live scores. Will retry shortly...');
        setLoading(false);
    }
};

            // Fetch chat from jsonbin
            const fetchChat = async () => {
    try {
        const response = await fetch(CONFIG.CHAT_READ_URL + '/latest', {
            headers: {
                'X-Master-Key': CONFIG.MASTER_KEY
            }
        });
        const json = await response.json();
        const result = json.record || json;
        if (result && result.messages) {
            setChatMessages(result.messages);
        }
    } catch (err) {
        console.error('Error fetching chat:', err);
    }
};

            // Send chat message ‚Äî writes still go to Apps Script (low concurrency, one person at a time)
            // After writing, Apps Script pushes updated chat to jsonbin, so we re-fetch after a short delay
            const sendChatMessage = async () => {
                if (!chatName.trim() || !chatMessage.trim() || isSendingChat) return;
                
                setIsSendingChat(true);
                
                try {
                    const url = `${CONFIG.CHAT_WRITE_URL}?action=addChat&name=${encodeURIComponent(chatName.trim())}&message=${encodeURIComponent(chatMessage.trim())}`;
                    
                    const response = await fetch(url);
                    const result = await response.json();
                    
                    if (result.success) {
                        setChatMessage('');
                        // The Apps Script pushChatToJsonbin runs after the write,
                        // so a short delay then re-fetch will pick it up
                        setTimeout(fetchChat, 1500);
                    }
                } catch (err) {
                    console.error('Error sending message:', err);
                    alert('Failed to send message. Please try again.');
                } finally {
                    setTimeout(() => setIsSendingChat(false), 2000);
                }
            };

            // Initial data fetch
            useEffect(() => {
                fetchData();
                if (CONFIG.CHAT_ENABLED) fetchChat();
            }, []);

            // Auto-refresh with jitter ‚Äî each user gets a slightly different interval
            // so 200 people don't all hammer jsonbin at the exact same second
            useEffect(() => {
                if (!isLive) return;
                
                // Each user gets base interval + 0-5 random seconds of jitter
                const jitter = Math.random() * 5000;
                const intervalTime = CONFIG.REFRESH_INTERVAL + jitter;

                const interval = setInterval(() => {
                    fetchData();
                    if (CONFIG.CHAT_ENABLED) fetchChat();
                }, intervalTime);

                return () => clearInterval(interval);
            }, [isLive]);

            // Auto-scroll chat to bottom
            useEffect(() => {
                if (chatMessagesRef.current) {
                    chatMessagesRef.current.scrollTop = chatMessagesRef.current.scrollHeight;
                }
            }, [chatMessages]);

            
            // Tour step definitions
            const tourSteps = [
                {
                    title: "Welcome to the Dashboard! üèà",
                    content: "Let's take a quick tour of the key features. This will only take a minute!",
                    target: null,
                    position: "center"
                },
                {
                    title: "Prize Winners",
                    content: "Hover over any prize card to see who's currently winning and how much they'll take home. The split updates live as the game progresses!",
                    target: ".prize-card",
                    position: "bottom"
                },
                {
                    title: "Pick Trends",
                    content: "See how everyone else bet on each question. Bars are color-coded by team and outcome. Find out if you went with the crowd or bet against the house!",
                    target: ".tab",
                    targetIndex: 1,
                    position: "bottom",
                    action: () => setActiveTab('trends')
                },
                {
                    title: "Trend Visualization",
                    content: "Each question shows the percentage breakdown of all picks. Seahawks picks are green, Patriots are red. Over/Under and Yes/No get their own colors too.",
                    target: ".trend-card",
                    position: "right"
                },
                {
                    title: "Full Results Table",
                    content: "This is where you can see everyone's picks in detail. Let's explore the powerful features here.",
                    target: ".tab",
                    targetIndex: 2,
                    position: "bottom",
                    action: () => setActiveTab('results')
                },
                {
                    title: "Question Details",
                    content: "Toggle this on to see all questions and their current results. You can filter by completed or outstanding bets.",
                    target: ".toggle-switch",
                    position: "left"
                },
                {
                    title: "Pin Your Friends",
                    content: "Search for players here and pin them to keep them at the top of the results table. Perfect for tracking your friends or rivals!",
                    target: ".search-box",
                    position: "bottom"
                },
                {
                    title: "Question Tooltips",
                    content: "Hover over any question number in the table to see the full question text and current result. No more squinting at tiny headers!",
                    target: ".results-table th",
                    targetIndex: 2,
                    position: "bottom"
                },
                {
                    title: "Smack Talk Forum",
                    content: "Head to the Chat tab to talk trash with everyone watching the game. Just remember: what happens in the chat stays in the chat! üòé",
                    target: ".tab",
                    targetIndex: 3,
                    position: "bottom"
                },
                {
                    title: "You're All Set! üéâ",
                    content: "That's everything! The dashboard updates live every 10 seconds. You can replay this tour anytime using the ? button in the bottom corner. Enjoy the game!",
                    target: null,
                    position: "center"
                }
            ];

            // Tour control functions
            const handleTourNext = () => {
                if (tourStep < tourSteps.length - 1) {
                    const nextStep = tourSteps[tourStep + 1];
                    if (nextStep.action) nextStep.action();
                    setTourStep(tourStep + 1);
                } else {
                    completeTour();
                }
            };

            const handleTourSkip = () => {
                completeTour();
            };

            const completeTour = () => {
                setTourActive(false);
                localStorage.setItem('tourCompleted', 'true');
                localStorage.removeItem('tourStarted');
                setActiveTab('leaderboard');
            };

            const replayTour = () => {
                localStorage.removeItem('tourCompleted');
                localStorage.removeItem('tourStarted');
                setTourActive(true);
                setTourStep(0);
            };

            // Auto-scroll to target element
            useEffect(() => {
                if (!tourActive) return;
                
                const step = tourSteps[tourStep];
                if (!step.target) return;
                
                // KEY FIX: Small timeout allows the Tab to switch before we calculate position
                setTimeout(() => {
                    let element;
                    if (step.targetIndex !== undefined) {
                        const elements = document.querySelectorAll(step.target);
                        element = elements[step.targetIndex];
                    } else {
                        element = document.querySelector(step.target);
                    }
                    
                    if (element) {
                        // KEY FIX: behavior 'auto' stops the drifting/lagging effect
                        element.scrollIntoView({ behavior: 'auto', block: 'center' });
                        tourTargetRef.current = element;
                        
                        // Force a recalculation of the spotlight position
                        window.dispatchEvent(new Event('resize'));
                    }
                }, 150); 
            }, [tourStep, tourActive]);

            // Close pick tooltip when clicking outside
useEffect(() => {
    const handleClickOutside = (e) => {
        if (!e.target.closest('.pick-cell')) {
            setActivePickCell(null);
        }
    };
    
    document.addEventListener('click', handleClickOutside);
    return () => document.removeEventListener('click', handleClickOutside);
}, []);
            
            // Sorting function for full results table
            const handleSort = (key) => {
                let direction = 'asc';
                if (sortConfig.key === key && sortConfig.direction === 'asc') {
                    direction = 'desc';
                }
                setSortConfig({ key, direction });
            };

            const getSortedResults = () => {
                if (!data?.fullResults) return [];
                
                const sorted = [...data.fullResults];
                
                if (sortConfig.key === 'name') {
    sorted.sort((a, b) => {
        const comparison = a.n.localeCompare(b.n);
                        return sortConfig.direction === 'asc' ? comparison : -comparison;
                    });
                } else if (sortConfig.key === 'points') {
    sorted.sort((a, b) => {
        const comparison = (b.p || 0) - (a.p || 0);
                        return sortConfig.direction === 'asc' ? -comparison : comparison;
                    });
                }
                
                return sorted;
            };

            const getSortClass = (key) => {
                if (sortConfig.key !== key) return 'sortable';
                return sortConfig.direction === 'asc' ? 'sorted-asc' : 'sorted-desc';
            };

            // Pin/unpin player functions
            const pinPlayer = (playerName) => {
                if (!pinnedPlayers.includes(playerName)) {
                    setPinnedPlayers([...pinnedPlayers, playerName]);
                }
                setSearchTerm('');
            };

            const unpinPlayer = (playerName) => {
                setPinnedPlayers(pinnedPlayers.filter(name => name !== playerName));
            };

            const clearAllPins = () => {
                setPinnedPlayers([]);
            };

            // Get sorted and filtered results with pinned players at top
            const getDisplayedResults = () => {
                if (!data?.fullResults) return [];
                
                let sorted = [...data.fullResults];
                
                if (sortConfig.key === 'name') {
                    sorted.sort((a, b) => {
                        const comparison = a.name.localeCompare(b.name);
                        return sortConfig.direction === 'asc' ? comparison : -comparison;
                    });
                } else if (sortConfig.key === 'points') {
                    sorted.sort((a, b) => {
                        const comparison = (b.points || 0) - (a.points || 0);
                        return sortConfig.direction === 'asc' ? -comparison : comparison;
                    });
                }
                
                const pinned = sorted.filter(p => pinnedPlayers.includes(p.n));
const unpinned = sorted.filter(p => !pinnedPlayers.includes(p.n));
                
                return [...pinned, ...unpinned];
            };

            // Search for player and highlight/suggest pinning
            const getSearchResults = () => {
                if (!searchTerm || !data?.fullResults) return [];
                const term = searchTerm.toLowerCase();
                return data.fullResults.filter(p => 
    p.n.toLowerCase().includes(term)
).slice(0, 5);
            };

            // Determine trend bar color based on option text
            const getTrendBarClass = (optionName) => {
                const name = optionName.toLowerCase();
                
                if (name.includes('seahawk') || name.includes('seattle')) {
                    return 'seahawks';
                }
                if (name.includes('patriot') || name.includes('new england')) {
                    return 'patriots';
                }
                if (name.includes('over')) {
                    return 'over';
                }
                if (name.includes('under')) {
                    return 'under';
                }
                if (name === 'yes') {
                    return 'yes';
                }
                if (name === 'no') {
                    return 'no';
                }
                
                return '';
            };

            // Get filtered questions based on current filter
            const getFilteredQuestions = () => {
                if (!data?.questions) return [];
                
                return data.questions.map((question, idx) => {
                    if (!question || question === '') return null;
                    
                    const hasResult = data.results?.[idx] && data.results[idx] !== '';
                    
                    if (questionFilter === 'completed' && !hasResult) return null;
                    if (questionFilter === 'pending' && hasResult) return null;
                    
                    return {
                        idx,
                        question,
                        result: hasResult ? data.results[idx] : null
                    };
                }).filter(q => q !== null);
            };

            // Get question counts for filter buttons
            const getQuestionCounts = () => {
                if (!data?.questions) return { all: 0, completed: 0, pending: 0 };
                
                let completed = 0;
                let pending = 0;
                let all = 0;
                
                data.questions.forEach((question, idx) => {
                    if (!question || question === '') return;
                    all++;
                    
                    const hasResult = data.results?.[idx] && data.results[idx] !== '';
                    if (hasResult) {
                        completed++;
                    } else {
                        pending++;
                    }
                });
                
                return { all, completed, pending };
            };

            // Determine if a player is in penultimate place
const isPenultimateRank = (rank) => {
    if (!data?.leaderboard || data.leaderboard.length < 2) return false;
    
    // Find the maximum rank (last place)
    const maxRank = Math.max(...data.leaderboard.map(p => p.rank));
    
    // Penultimate is second-to-last (maxRank - 1)
    const penultimateRank = maxRank - 1;
    
    return rank === penultimateRank;
};
            
            // Tour spotlight component
            const TourSpotlight = () => {
                if (!tourActive) return null;
                
                const step = tourSteps[tourStep];
                const [spotlightStyle, setSpotlightStyle] = useState({});
                const [tooltipStyle, setTooltipStyle] = useState({});
                
                useEffect(() => {
                    if (!step.target) {
                        setTooltipStyle({
                            top: '50%',
                            left: '50%',
                            transform: 'translate(-50%, -50%)'
                        });
                        return;
                    }
                    
                    const updatePosition = () => {
                        let element;
                        if (step.targetIndex !== undefined) {
                            const elements = document.querySelectorAll(step.target);
                            element = elements[step.targetIndex];
                        } else {
                            element = document.querySelector(step.target);
                        }
                        
                        if (!element) return;
                        
                        const rect = element.getBoundingClientRect();
                        const padding = 8;
                        
                        setSpotlightStyle({
                            top: `${rect.top - padding}px`,
                            left: `${rect.left - padding}px`,
                            width: `${rect.width + padding * 2}px`,
                            height: `${rect.height + padding * 2}px`
                        });
                        
                        const tooltipWidth = 400;
                        const tooltipHeight = 300;
                        let top, left;
                        
                        switch(step.position) {
                            case 'bottom':
                                top = rect.bottom + 20;
                                left = rect.left + rect.width / 2 - tooltipWidth / 2;
                                break;
                            case 'top':
                                top = rect.top - tooltipHeight - 20;
                                left = rect.left + rect.width / 2 - tooltipWidth / 2;
                                break;
                            case 'left':
                                top = rect.top + rect.height / 2 - tooltipHeight / 2;
                                left = rect.left - tooltipWidth - 20;
                                break;
                            case 'right':
                                top = rect.top + rect.height / 2 - tooltipHeight / 2;
                                left = rect.right + 20;
                                break;
                            default:
                                top = rect.bottom + 20;
                                left = rect.left;
                        }
                        
                        const maxLeft = window.innerWidth - tooltipWidth - 20;
                        const maxTop = window.innerHeight - tooltipHeight - 20;
                        left = Math.max(20, Math.min(left, maxLeft));
                        top = Math.max(20, Math.min(top, maxTop));
                        
                        setTooltipStyle({
                            top: `${top}px`,
                            left: `${left}px`
                        });
                    };
                    
                    updatePosition();
                    window.addEventListener('resize', updatePosition);
                    return () => window.removeEventListener('resize', updatePosition);
                }, [tourStep, step]);
                
                return (
                    <>
                        <div className="tour-overlay" onClick={handleTourSkip} />
                        {step.target && <div className="tour-spotlight" style={spotlightStyle} />}
                        <div className="tour-tooltip" style={tooltipStyle}>
                            <div className="tour-tooltip-header">
                                <div className="tour-tooltip-title">{step.title}</div>
                                <div className="tour-tooltip-counter">
                                    {tourStep + 1} of {tourSteps.length}
                                </div>
                            </div>
                            <div className="tour-tooltip-content">
                                {step.content}
                            </div>
                            <div className="tour-tooltip-buttons">
                                <button className="tour-button tour-button-skip" onClick={handleTourSkip}>
                                    Skip Tour
                                </button>
                                <button className="tour-button tour-button-next" onClick={handleTourNext}>
                                    {tourStep === tourSteps.length - 1 ? 'Get Started' : 'Next'}
                                </button>
                            </div>
                        </div>
                    </>
                );
            };

            // Loading state
            if (loading) {
                return (
                    <div className="container">
                        <div className="loading">Loading dashboard...</div>
                    </div>
                );
            }

            // Error state
            if (error) {
                return (
                    <div className="container">
                        <div className="error">
                            <h2>‚ö†Ô∏è Connection Error</h2>
                            <p>{error}</p>
                            <p style={{marginTop: '10px', fontSize: '0.9rem'}}>
                                Make sure you've set up the Google Apps Script and updated the SHEET_API_URL in this file.
                            </p>
                        </div>
                    </div>
                );
            }

            // Countdown mode (before go-live)
            if (!isLive) {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>
                                <img 
                                    src="https://a.espncdn.com/combiner/i?img=/i/teamlogos/nfl/500/ne.png" 
                                    alt="Patriots Logo" 
                                    className="team-logo patriots"
                                    onError={(e) => e.target.style.display = 'none'}
                                />
                                <span className="header-title-text">
                                    <span className="word-1">2026 </span>
                                    <span className="word-2">McDraper </span>
                                    <span className="word-3">Super Bowl </span>
                                    <span className="word-4">LX </span>
                                    <span className="word-5">Prop Bets</span>
                                </span>
                                <img 
                                    src="https://a.espncdn.com/combiner/i?img=/i/teamlogos/nfl/500/sea.png" 
                                    alt="Seahawks Logo" 
                                    className="team-logo seahawks"
                                    onError={(e) => e.target.style.display = 'none'}
                                />
                            </h1>
                        </div>

                        <div className="countdown-container">
                            <div className="countdown-title">Dashboard Goes Live In:</div>
                            
                            <div className="countdown-timer">
                                <div className="countdown-unit">
                                    <div className="countdown-number">{countdown.days}</div>
                                    <div className="countdown-label">Days</div>
                                </div>
                                <div className="countdown-unit">
                                    <div className="countdown-number">{countdown.hours}</div>
                                    <div className="countdown-label">Hours</div>
                                </div>
                                <div className="countdown-unit">
                                    <div className="countdown-number">{countdown.minutes}</div>
                                    <div className="countdown-label">Minutes</div>
                                </div>
                                <div className="countdown-unit">
                                    <div className="countdown-number">{countdown.seconds}</div>
                                    <div className="countdown-label">Seconds</div>
                                </div>
                            </div>

                            <div className="countdown-message">
                                üèà The dashboard will go live at 4:30 PM EST on Sunday, February 8th, 2026<br/>
                                Get your picks in before then!
                            </div>

                            <div className="stats-bar" style={{marginTop: '40px', maxWidth: '400px'}}>
                                <div className="stat-card">
                                    <div className="stat-label">üí∞ Total Prize Pool</div>
                                    <div className="stat-value prize-value">${data.stats?.prizePool || 0}</div>
                                </div>
                            </div>
                        </div>

                        <button className="admin-login-link" onClick={() => setShowAdminModal(true)}>
                            üîë
                        </button>

                        {showAdminModal && (
                            <div className="admin-modal">
                                <div className="admin-modal-content">
                                    <div className="admin-modal-title">Admin Access</div>
                                    <input
                                        type="password"
                                        className="admin-code-input"
                                        placeholder="Enter admin code"
                                        value={adminCodeInput}
                                        onChange={(e) => setAdminCodeInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAdminLogin()}
                                    />
                                    <button className="admin-button" onClick={handleAdminLogin}>
                                        Login
                                    </button>
                                    <button className="admin-button cancel" onClick={() => {
                                        setShowAdminModal(false);
                                        setAdminCodeInput('');
                                    }}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // Full dashboard (when live or in admin mode)
            return (
                <div className="container">
                    {isAdminMode && (
                        <div className="admin-indicator">
                            üîì Admin Mode
                        </div>
                    )}

                    <div className="header">
                        <h1>
                            <img 
                                src="https://a.espncdn.com/combiner/i?img=/i/teamlogos/nfl/500/ne.png" 
                                alt="Patriots Logo" 
                                className="team-logo patriots"
                                onError={(e) => e.target.style.display = 'none'}
                            />
                            <span className="header-title-text">
                                <span className="word-1">2026 </span>
                                <span className="word-2">McDraper </span>
                                <span className="word-3">Super Bowl </span>
                                <span className="word-4">LX </span>
                                <span className="word-5">Prop Bets</span>
                            </span>
                            <img 
                                src="https://a.espncdn.com/combiner/i?img=/i/teamlogos/nfl/500/sea.png" 
                                alt="Seahawks Logo" 
                                className="team-logo seahawks"
                                onError={(e) => e.target.style.display = 'none'}
                            />
                        </h1>
                        <div className="subtitle">Seahawks vs Patriots ‚Ä¢ Live Leaderboard</div>
                    </div>

                    <div className="stats-bar">
                        <div className="stat-card">
                            <div className="stat-label">üí∞ Prize Pool</div>
                            <div className="stat-value prize-value">${data.stats?.prizePool || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‚úÖ Bets Completed</div>
                            <div className="stat-value">{data.stats?.completed || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‚è≥ Bets Remaining</div>
                            <div className="stat-value">{data.stats?.remaining || 0}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">üë• Total Entries</div>
                            <div className="stat-value">{data.stats?.totalEntries || 0}</div>
                        </div>
                    </div>

                    <div className="prize-section">
                        {data.prizes?.map((prize, idx) => (
                            <div key={idx} className="prize-card">
                                <div className="prize-place">{prize.place}</div>
                                <div className="prize-amount">${prize.amount}</div>
                                <div className="prize-winners">{prize.winners}</div>
                                
                                {prize.playerList && prize.playerList.length > 0 && (
                                    <div className="prize-tooltip">
                                        <div className="prize-tooltip-title">{prize.place} Winners</div>
                                        {prize.playerList.map((player, pIdx) => (
                                            <div key={pIdx} className="prize-tooltip-player">
                                                <span className="prize-tooltip-player-name">{player}</span>
                                                <span className="prize-tooltip-player-amount">${player.share}</span>
                                            </div>
                                        ))}
                                        <div className="prize-tooltip-total">
                                            <span className="prize-tooltip-total-label">Total Pool:</span>
                                            <span className="prize-tooltip-total-amount">${prize.amount}</span>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>

                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'leaderboard' ? 'active' : ''}`}
                            onClick={() => setActiveTab('leaderboard')}
                        >
                            üèÜ Leaderboard
                        </button>
                        <button 
                            className={`tab ${activeTab === 'trends' ? 'active' : ''}`}
                            onClick={() => setActiveTab('trends')}
                        >
                            üìä Pick Trends
                        </button>
                        <button 
                            className={`tab ${activeTab === 'results' ? 'active' : ''}`}
                            onClick={() => setActiveTab('results')}
                        >
                            üìã Full Results
                        </button>
                        {CONFIG.CHAT_ENABLED && (
                            <button 
                                className={`tab ${activeTab === 'chat' ? 'active' : ''}`}
                                onClick={() => setActiveTab('chat')}
                            >
                                üí¨ Smack Talk
                            </button>
                        )}
                    </div>

                    {activeTab === 'leaderboard' && (
                        <div className="leaderboard">
                            <div className="leaderboard-header">
                                <div>Rank</div>
                                <div>Player</div>
                                <div>Points</div>
                                <div className="percentage">Accuracy</div>
                            </div>
{data.leaderboard?.map((player, idx) => {
    // Calculate percentage on frontend (no longer in data)
    const totalBets = data.stats?.totalBets || 25;
    const percentage = totalBets > 0 
        ? `${Math.round((player.p / totalBets) * 100)}%` 
        : '0%';
    
    return (
        <div key={idx} className="leaderboard-row">
            <div className={`rank ${player.rank <= 3 ? `rank-${player.rank}` : ''} ${isPenultimateRank(player.rank) ? 'rank-penultimate' : ''}`}>
                {player.rank}
            </div>
            <div className="player-name">{player.n}</div>
            <div className="points">{player.p}</div>
            <div className="percentage">{percentage}</div>
        </div>
    );
})}                        </div>
                    )}

                    {activeTab === 'trends' && (
    <div className="trends-grid">
        {calculateTrends(data).map((trend, idx) => (
                                <div key={idx} className="trend-card">
                                    <div className="trend-question">{trend.question}</div>
                                    {trend.options.map((option, optIdx) => (
                                        <div key={optIdx} className="trend-option">
                                            <div className="trend-label">
                                                <span className="trend-name">{option.name}</span>
                                                <span className="trend-percent">{option.percent}%</span>
                                            </div>
                                            <div className="trend-bar">
                                                <div 
                                                    className={`trend-fill ${getTrendBarClass(option.name)}`}
                                                    style={{width: `${option.percent}%`}}
                                                ></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    )}

                    {activeTab === 'results' && (
                        <div className="leaderboard">
                            <h2 style={{marginBottom: '20px', fontFamily: 'Oswald'}}>Full Results by Player</h2>
                            
                            <div className="question-toggle-container">
                                <span className="question-toggle-label">Show Question Details</span>
                                <div 
                                    className={`toggle-switch ${showQuestionDetails ? 'active' : ''}`}
                                    onClick={() => setShowQuestionDetails(!showQuestionDetails)}
                                >
                                    <div className="toggle-slider"></div>
                                </div>
                            </div>

                            {showQuestionDetails && (
                                <div className="question-details-panel">
                                    <h3 style={{marginBottom: '15px', color: 'var(--seahawks-green)', fontSize: '1.1rem'}}>
                                        üìã All Questions & Results
                                    </h3>
                                    
                                    <div className="question-filter-container">
                                        <button 
                                            className={`filter-button ${questionFilter === 'all' ? 'active' : ''}`}
                                            onClick={() => setQuestionFilter('all')}
                                        >
                                            All Bets
                                            <span className="filter-count">{getQuestionCounts().all}</span>
                                        </button>
                                        <button 
                                            className={`filter-button ${questionFilter === 'completed' ? 'active' : ''}`}
                                            onClick={() => setQuestionFilter('completed')}
                                        >
                                            ‚úì Completed
                                            <span className="filter-count">{getQuestionCounts().completed}</span>
                                        </button>
                                        <button 
                                            className={`filter-button ${questionFilter === 'pending' ? 'active' : ''}`}
                                            onClick={() => setQuestionFilter('pending')}
                                        >
                                            ‚è≥ Outstanding
                                            <span className="filter-count">{getQuestionCounts().pending}</span>
                                        </button>
                                    </div>
                                    
                                    {getFilteredQuestions().map((item) => (
                                        <div key={item.idx} className="question-item">
                                            <span className="question-number">{item.idx + 1}.</span>
                                            <span className="question-text">{item.question}</span>
                                            <span className={item.result ? 'question-result' : 'question-pending'}>
                                                {item.result ? `‚úì ${item.result}` : 'Pending...'}
                                            </span>
                                        </div>
                                    ))}
                                    
                                    {getFilteredQuestions().length === 0 && (
                                        <div style={{
                                            textAlign: 'center',
                                            padding: '20px',
                                            color: 'var(--text-secondary)',
                                            fontStyle: 'italic'
                                        }}>
                                            {questionFilter === 'completed' && 'No completed bets yet'}
                                            {questionFilter === 'pending' && 'No outstanding bets'}
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            <div className="search-pin-container">
                                <div className="search-box">
                                    <span className="search-icon">üîç</span>
                                    <input
                                        type="text"
                                        className="search-input"
                                        placeholder="Search for a player to pin..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    {searchTerm && getSearchResults().length > 0 && (
                                        <div style={{
                                            position: 'absolute',
                                            top: '100%',
                                            left: 0,
                                            right: 0,
                                            background: 'var(--bg-card)',
                                            border: '1px solid var(--seahawks-green)',
                                            borderRadius: '10px',
                                            marginTop: '5px',
                                            zIndex: 1000,
                                            maxHeight: '200px',
                                            overflowY: 'auto'
                                        }}>
                                           {getSearchResults().map((player, idx) => (
    <div
        key={idx}
        onClick={() => pinPlayer(player.n)}
                                                    style={{
                                                        padding: '10px 15px',
                                                        cursor: 'pointer',
                                                        borderBottom: idx < getSearchResults().length - 1 ? '1px solid rgba(255,255,255,0.05)' : 'none',
                                                        transition: 'background 0.2s ease'
                                                    }}
                                                    onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(105, 190, 40, 0.1)'}
                                                    onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                                                >
                                                   <strong>{player.n}</strong> - {player.p} points
{!pinnedPlayers.includes(player.n) && (
                                                        <span style={{float: 'right', color: 'var(--seahawks-green)'}}>üìå Click to pin</span>
                                                    )}
                                                   {pinnedPlayers.includes(player.n) && (
                                                        <span style={{float: 'right', color: 'var(--text-secondary)'}}>‚úì Pinned</span>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                {pinnedPlayers.length > 0 && (
                                    <div className="pinned-players">
                                        <span className="pinned-label">Pinned:</span>
                                        {pinnedPlayers.map((name, idx) => (
                                            <div key={idx} className="pinned-tag">
                                                <span className="pinned-tag-icon">üìå</span>
                                                <span>{name}</span>
                                                <span 
                                                    className="pinned-tag-remove"
                                                    onClick={() => unpinPlayer(name)}
                                                >
                                                    √ó
                                                </span>
                                            </div>
                                        ))}
                                        <button className="clear-pins-btn" onClick={clearAllPins}>
                                            Clear All
                                        </button>
                                    </div>
                                )}
                            </div>
                            
                            <div className="full-results-table">
                                <table className="results-table">
                                    <thead>
                                        <tr>
                                            <th 
                                                className={getSortClass('name')}
                                                onClick={() => handleSort('name')}
                                            >
                                                Player
                                            </th>
                                            <th 
                                                className={getSortClass('points')}
                                                onClick={() => handleSort('points')}
                                            >
                                                Points
                                            </th>
                                            {data.questions?.map((question, idx) => {
                                                if (!question || question === '') return null;
                                                
                                                return (
                                                    <th key={idx} style={{position: 'relative'}}>
                                                        <span 
                                                            className="question-cell"
                                                            style={{display: 'inline-block', cursor: 'help'}}
                                                            title={question}
                                                        >
                                                            {idx + 1}
                                                            <span className="question-tooltip">
                                                                <div className="question-tooltip-title">
    {decompressQuestion(question)}
</div>
                                                                {data.results && data.results[idx] && data.results[idx] !== '' ? (
                                                                    <div className="question-tooltip-result">
                                                                        <div className="question-tooltip-result-label">Result:</div>
                                                                        <div>{data.results[idx]}</div>
                                                                    </div>
                                                                ) : (
                                                                    <div className="question-tooltip-pending">
                                                                        Pending...
                                                                    </div>
                                                                )}
                                                            </span>
                                                        </span>
                                                    </th>
                                                );
                                            })}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {getDisplayedResults().map((player, idx) => (
    <tr 
        key={idx}
        className={pinnedPlayers.includes(player.n) ? 'pinned-row' : ''}
    >
        <td style={{fontWeight: 600}}>{player.n}</td>
        <td style={{fontWeight: 700, color: 'var(--accent-glow)'}}>{player.p}</td>
        {player.k?.map((pick, pickIdx) => {    
        
        const correctAnswer = data.results?.[pickIdx];
    const status = (correctAnswer !== '' && correctAnswer != null)
        ? (pick === correctAnswer ? 'correct' : 'incorrect')
        : 'pending';
    
    const cellId = `${player.n}-${pickIdx}`;
    const isActive = activePickCell === cellId;
    const isFirstRow = idx === 0; // Check if this is the top player
    
    return (
        <td 
            key={pickIdx} 
            className={`pick-cell ${
                status === 'correct' ? 'correct-pick' :
                status === 'incorrect' ? 'incorrect-pick' :
                'pending-pick'
            } ${isActive ? 'active' : ''} ${isFirstRow ? 'first-row' : ''}`}
            onClick={(e) => {
                e.stopPropagation();
                setActivePickCell(isActive ? null : cellId);
            }}
        >
            {status === 'correct' ? '‚úì' :
             status === 'incorrect' ? '‚úó' : '‚àí'}
            
            <span className="pick-tooltip">
                <div className="pick-tooltip-label">Pick:</div>
               <div className={`pick-tooltip-value ${status}`}>
    {decompressText(pick) || 'No pick'}
</div>
            </span>
        </td>
    );
})}                                           </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}

                    {activeTab === 'chat' && CONFIG.CHAT_ENABLED && (
                        <div className="chat-container">
                            <h2 style={{marginBottom: '20px', fontFamily: 'Oswald'}}>üí¨ Smack Talk Forum</h2>
                            <div className="chat-messages" ref={chatMessagesRef}>
                                {chatMessages.map((msg, idx) => (
                                    <div key={idx} className="chat-message">
                                        <div className="chat-author">{msg.name}</div>
                                        <div className="chat-text">{msg.message}</div>
                                        <div className="chat-time">{msg.time}</div>
                                    </div>
                                ))}
                                {chatMessages.length === 0 && (
                                    <div style={{textAlign: 'center', color: 'var(--text-secondary)', marginTop: '50px'}}>
                                        No messages yet. Be the first to talk some smack! üî•
                                    </div>
                                )}
                            </div>
                            <div className="chat-input-container">
                                <input
                                    type="text"
                                    className="chat-input"
                                    placeholder="Your name..."
                                    value={chatName}
                                    onChange={(e) => setChatName(e.target.value)}
                                    style={{flex: '0 0 150px'}}
                                />
                                <input
                                    type="text"
                                    className="chat-input"
                                    placeholder="Type your message..."
                                    value={chatMessage}
                                    onChange={(e) => setChatMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && !isSendingChat && sendChatMessage()}
                                />
                                <button 
                                    className="chat-button" 
                                    onClick={sendChatMessage}
                                    disabled={isSendingChat}
                                >
                                    {isSendingChat ? 'Sending...' : 'Send'}
                                </button>
                            </div>
                        </div>
                    )}

                    {lastUpdate && (
                        <div className="update-indicator">
                            Last updated: {lastUpdate.toLocaleTimeString()}
                        </div>
                    )}

                    {!isAdminMode && (
                        <button className="admin-login-link" onClick={() => setShowAdminModal(true)}>
                            üîë
                        </button>
                    )}

                        {!tourActive && isLive && (
                            <button 
                                className="tour-replay-button" 
                                onClick={replayTour}
                                title="Replay feature tour"
                            >
                                ?
                            </button>
                        )}


                    {showAdminModal && (
                        <div className="admin-modal">
                            <div className="admin-modal-content">
                                <div className="admin-modal-title">Admin Access</div>
                                <input
                                    type="password"
                                    className="admin-code-input"
                                    placeholder="Enter admin code"
                                    value={adminCodeInput}
                                    onChange={(e) => setAdminCodeInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleAdminLogin()}
                                />
                                <button className="admin-button" onClick={handleAdminLogin}>
                                    Login
                                </button>
                                <button className="admin-button cancel" onClick={() => {
                                    setShowAdminModal(false);
                                    setAdminCodeInput('');
                                }}>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}
                  <TourSpotlight />
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
